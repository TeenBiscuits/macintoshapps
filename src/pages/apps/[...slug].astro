---
import { type CollectionEntry, getCollection } from "astro:content";
import { Image } from "astro:assets";
import { Icon } from "astro-icon/components";

import BaseLayout from "@/layouts/BaseLayout.astro";
import BackLink from "@/components/BackLink.astro";
import SeoApp from "@/components/SeoApp.astro";

interface Props {
  app: CollectionEntry<"apps">;
}

export async function getStaticPaths() {
  const apps = await getCollection("apps");
  return apps.map((app) => ({
    params: { slug: app.slug },
    props: { app },
  }));
}

const { app } = Astro.props;
const { Content } = await app.render();
---

<BaseLayout>
  <SeoApp slot="head" entry={app} />
  <div>
    <div class="mx-auto max-w-[80ch] pt-12">
      <BackLink />
    </div>
    <div class="mx-auto flex max-w-[80ch] items-center gap-2 pt-12 sm:pt-16">
      <Image
        src={app.data.icon}
        width={100}
        height={100}
        quality="medium"
        format="webp"
        alt={app.data.title}
        loading="eager"
        class="size-24"
        transition:name={`${app.data.title}-icon`}
      />
      <div class="grid sm:gap-1">
        <h1
          class="flex items-center gap-1.5 text-2xl font-semibold sm:text-4xl"
          transition:name={`${app.data.title}-title`}
        >
          <a
            href={app.data.link}
            class="hover:underline"
            target="_blank"
            referrerpolicy="no-referrer">{app.data.title}</a
          >
          <Icon
            name="external-link"
            class="size-4 text-lightModeForegroundMuted sm:size-6 dark:text-darkModeForegroundMuted"
          />
        </h1>
        <p
          class="text-lightModeForegroundMuted sm:text-base dark:text-darkModeForegroundMuted"
          transition:name={`${app.data.title}-mutedText`}
        >
          {app.data.developerName}
        </p>
      </div>
    </div>

    <!-- AppInfoCard -->

    <hr class="mx-auto mt-10 max-w-[80ch]" />
    <div
      class="mx-auto grid max-w-[80ch] grid-cols-2 gap-x-6 py-3 sm:grid-cols-4"
    >
      <div class="px-3 py-4 text-center">
        <span
          class="text-xs font-semibold uppercase text-lightModeForegroundMuted dark:text-darkModeForegroundMuted"
          >Category</span
        >
        <div class="capitalize">{app.data.category}</div>
      </div>

      <div class="px-3 py-4 text-center">
        <span
          class="text-xs font-semibold uppercase text-lightModeForegroundMuted dark:text-darkModeForegroundMuted"
          >Monetization</span
        >
        <div class="capitalize">{app.data.monetization}</div>
      </div>

      {
        app.data.isOpenSource ? (
          <div class="px-3 py-4 text-center">
            <span class="text-xs font-semibold uppercase text-lightModeForegroundMuted dark:text-darkModeForegroundMuted">
              Open source
            </span>
            <div class="capitalize">yes</div>
          </div>
        ) : null
      }

      {
        app.data.isRecommended ? (
          <div class="px-3 py-4 text-center">
            <span class="text-xs font-semibold uppercase text-lightModeForegroundMuted dark:text-darkModeForegroundMuted">
              Recommended
            </span>
            <div class="capitalize">true</div>
          </div>
        ) : null
      }
    </div>
    <hr class="mx-auto mb-10 max-w-[80ch]" />

    <!-- AppInfoCard -->

    <div
      class="content prose prose-lg prose-neutral mx-auto sm:prose-xl dark:prose-invert"
    >
      <Content />
    </div>
  </div>
</BaseLayout>
